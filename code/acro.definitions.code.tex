\AcroModule{definitions}{definitions of user commands}

% --------------------------------------------------------------------------
% commands for typesetting acronyms:
\NewAcroCommand \ac {m}
  { \UseAcroTemplate {first} {#1} }
\NewAcroCommand \acp {m}
  { \acroplural \UseAcroTemplate {first} {#1} }
\NewAcroCommand \iac {m}
  { \acroindefinite \UseAcroTemplate {first} {#1} }
\NewAcroCommand \Ac {m}
  { \acroupper \UseAcroTemplate {first} {#1} }
\NewAcroCommand \Acp {m}
  { \acroplural \acroupper \UseAcroTemplate {first} {#1} }
\NewAcroCommand \Iac {m}
  { \acroupper \acroindefinite \UseAcroTemplate {first} {#1} }

\NewAcroCommand \acs {m}
  { \UseAcroTemplate {short} {#1} }
\NewAcroCommand \acsp {m}
  { \acroplural \UseAcroTemplate {short} {#1} }
\NewAcroCommand \iacs {m}
  { \acroindefinite \UseAcroTemplate {short} {#1} }
\NewAcroCommand \Acs {m}
  { \acroupper \UseAcroTemplate {short} {#1} }
\NewAcroCommand \Acsp {m}
  { \acroplural \acroupper \UseAcroTemplate {short} {#1} }
\NewAcroCommand \Iacs {m}
  { \acroupper \acroindefinite \UseAcroTemplate {short} {#1} }
  
\NewAcroCommand \acl {m}
  { \UseAcroTemplate {long} {#1} }
\NewAcroCommand \aclp {m}
  { \acroplural \UseAcroTemplate {long} {#1} }
\NewAcroCommand \iacl {m}
  { \acroindefinite \UseAcroTemplate {long} {#1} }
\NewAcroCommand \Acl {m}
  { \acroupper \UseAcroTemplate {long} {#1} }
\NewAcroCommand \Aclp {m}
  { \acroplural \acroupper \UseAcroTemplate {long} {#1} }
\NewAcroCommand \Iacl {m}
  { \acroupper \acroindefinite \UseAcroTemplate {long} {#1} }

\NewAcroCommand \aca {m}
  { \UseAcroTemplate {alt} {#1} }
\NewAcroCommand \acap {m}
  { \acroplural \UseAcroTemplate {alt} {#1} }
\NewAcroCommand \iaca {m}
  { \acroindefinite \UseAcroTemplate {alt} {#1} }
\NewAcroCommand \Aca {m}
  { \acroupper \UseAcroTemplate {alt} {#1} }
\NewAcroCommand \Acap {m}
  { \acroplural \acroupper \UseAcroTemplate {alt} {#1} }
\NewAcroCommand \Iaca {m}
  { \acroupper \acroindefinite \UseAcroTemplate {alt} {#1} }

\NewAcroCommand \acf {m}
  { \acrofull \UseAcroTemplate {first} {#1} }
\NewAcroCommand \acfp {m}
  { \acrofull \acroplural \UseAcroTemplate {first} {#1} }
\NewAcroCommand \iacf {m}
  { \acrofull \acroindefinite \UseAcroTemplate {first} {#1} }
\NewAcroCommand \Acf {m}
  { \acrofull \acroupper \UseAcroTemplate {first} {#1} }
\NewAcroCommand \Acfp {m}
  { \acrofull \acroplural \acroupper \UseAcroTemplate {first} {#1} }
\NewAcroCommand \Iacf {m}
  { \acrofull \acroupper \acroindefinite \UseAcroTemplate {first} {#1} }

\NewAcroCommand \acshow {m}
  { \acrodonotuse \UseAcroTemplate {show} {#1} }

% --------------------------------------------------------------------------
\DeclareAcroEnding {plural} {s} {s}

\DeclareAcroArticle {indefinite} {a}

\ProvideExpandableDocumentCommand \nospace {} {}

% --------------------------------------------------------------------------
% acronym templates:
\NewAcroTemplate {long-short}
  {
    \acroiffirstTF
      {
        \acrowrite {long}
        \acspace
          (
            \acroifT {foreign} { \acrowrite {foreign} ,~ }
            \acrowrite {short}
            \acroifT {alt} { ~ \acrotranslate {or} ~ \acrowrite {alt} }
            \acrogroupcite
          )
      }
      { \acrowrite {short} }
  }

\NewAcroTemplate {short-long}
  {
    \acrowrite {short}
    \acroiffirstT
      {
        \space
          (
            \acroifT {alt} { \acrotranslate {or} ~ \acrowrite {alt} ~ }
            \acroifT {foreign} { \acrowrite {foreign} :~ }
            \acrowrite {long}
            \acrogroupcite
          )
      }
  }

\NewAcroTemplate {footnote}
  {
    \acrowrite {short}
    \acroiffirstT
      {
        \acfootnote
          {
            \acroifT {alt} { \acrotranslate {or} ~ \acrowrite {alt} :~ }
            \acroifT {foreign} { \acrowrite {foreign} ,~ }
            \acrowrite {long}
            \acrogroupcite
            \acroendfootnote
          }
      }
  }

\ProvideDocumentCommand \acroendfootnote {} {}
  
\NewAcroTemplate {long}
  { \acrowrite {long} }

\NewAcroTemplate {single}
  { \acrowrite {single} }

\NewAcroTemplate {short}
  { \acrowrite {short} }

\NewAcroTemplate {alt}
  {
    \acroifTF {alt}
      { \acrowrite {alt} }
      { \acrowrite {short} }
  }

\NewAcroTemplate {show}
  {
    \iow_term:n {}
    \iow_term:x
      {
        The~ acronym~ `\AcronymID'~ has~ the~ properties~ (without~ outer~
        braces):
      }
    \iow_term:n {}
    \AcroPropertiesMap { \acroshow {##1} }
    \iow_term:n {}
  }

% --------------------------------------------------------------------------
% heading templates:
\NewAcroTemplate[heading] {none} { }

\NewAcroTemplate[heading] {section}
  { \section { \acrolistname } }

\NewAcroTemplate[heading] {section*}
  { \section* { \acrolistname } }

\acro_if_komascript:T
  {
    \NewAcroTemplate[heading] {addsec}
      { \addsec { \acrolistname } }
    \NewAcroTemplate[heading] {addsec*}
      { \addsec* { \acrolistname } }
  }
  
\cs_if_exist:NT \chapter
  {
    \NewAcroTemplate[heading] {chapter}
      { \chapter { \acrolistname } }
    \NewAcroTemplate[heading] {chapter*}
      { \chapter* { \acrolistname } }
    \acro_if_komascript:T
      {
        \NewAcroTemplate[heading] {addchap}
        { \addchap { \acrolistname } }
        \NewAcroTemplate[heading] {addchap*}
        { \addchap* { \acrolistname } }
      }
  }

% --------------------------------------------------------------------------
% list templates:
\NewAcroTemplate[list] {description}
  {
    \acroheading
    \acropreamble
    \begin {description}
      \acronymsmapF
        {
          \item [ \acrowrite {short} \acroifT {alt} {/} \acrowrite {alt} ]
            \acrowrite {list}
            \acroifanyT {foreign,extra} {~(}
            \acrowrite {foreign}
            \acroifallT {foreign,extra} {,~}
            \acrowrite {extra}
            \acroifanyT {foreign,extra} {)}
            \acropagefill
            \acropages
              { \acrotranslate {page} \nobreakspace }
              { \acrotranslate {pages} \nobreakspace }
        }
        { \item \AcroRerun }
    \end {description}
  }

\tl_new:N \l_acro_table_colspec_tl
\keys_define:nn {acro/templates}
  {
    colspec .tl_set:N  = \l_acro_table_colspec_tl ,
    colspec .initial:n = {>{\bfseries}lp{.7\linewidth}}
  }

\NewAcroTemplate[list] {tabular}
  {
    \AcroNeedPackage {array}
    \acronymsmapF
      {
        \AcroAddRow
          {
            \acrowrite {short}
            \acroifT {alt} {/} \acrowrite {alt}
            &
            \acrowrite {list}
            \acroifanyT {foreign,extra} {~(}
            \acrowrite {foreign}
            \acroifallT {foreign,extra} {,~}
            \acrowrite {extra}
            \acroifanyT {foreign,extra} {)}
            \acropagefill
            \acropages
              { \acrotranslate {page} \nobreakspace }
              { \acrotranslate {pages} \nobreakspace }
            \tabularnewline
          }
      }
      { \AcroRerun }
    \acroheading
    \acropreamble
    \par \noindent
    \exp_args:NnV
    \begin {tabular} \l_acro_table_colspec_tl
      \AcronymTable
    \end {tabular}
  }

\NewAcroTemplate[list] {longtable}
  {
    \AcroNeedPackage {array,longtable}
    \acronymsmapF
      {
        \AcroAddRow
          {
            \acrowrite {short}
            \acroifT {alt} {/} \acrowrite {alt}
            &
            \acrowrite {list}
            \acroifanyT {foreign,extra} {~(}
            \acrowrite {foreign}
            \acroifallT {foreign,extra} {,~}
            \acrowrite {extra}
            \acroifanyT {foreign,extra} {)}
            \acropagefill
            \acropages
              { \acrotranslate {page} \nobreakspace }
              { \acrotranslate {pages} \nobreakspace }
            \tabularnewline
          }
      }
      { \AcroRerun }  
    \acroheading
    \acropreamble
    \par \noindent
    \exp_args:NnV
    \begin {longtable} \l_acro_table_colspec_tl
      \AcronymTable
    \end {longtable}
    \addtocounter {table} {-1}
  }

\NewAcroTemplate[list] {supertabular}
  {
    \AcroNeedPackage {array,supertabular}
    \acronymsmapF
      {
        \AcroAddRow
          {
            \acrowrite {short}
            \acroifT {alt} {/} \acrowrite {alt}
            &
            \acrowrite {list}
            \acroifanyT {foreign,extra} {~(}
            \acrowrite {foreign}
            \acroifallT {foreign,extra} {,~}
            \acrowrite {extra}
            \acroifanyT {foreign,extra} {)}
            \acropagefill
            \acropages
              { \acrotranslate {page} \nobreakspace }
              { \acrotranslate {pages} \nobreakspace }
            \tabularnewline
          }
      }
      { \AcroRerun }  
    \acroheading
    \acropreamble
    \par \noindent
    \exp_args:NnV
    \begin {supertabular} \l_acro_table_colspec_tl
      \AcronymTable
    \end {supertabular}
  }

\NewAcroTemplate[list] {xltabular}
  {
    \AcroNeedPackage {xltabular}
    \acronymsmapF
      {
        \AcroAddRow
          {
            \acrowrite {short}
            \acroifT {alt} {/} \acrowrite {alt}
            &
            \acrowrite {list}
            \acroifanyT {foreign,extra} {~(}
            \acrowrite {foreign}
            \acroifallT {foreign,extra} {,~}
            \acrowrite {extra}
            \acroifanyT {foreign,extra} {)}
            \acropagefill
            \acropages
              { \acrotranslate {page} \nobreakspace }
              { \acrotranslate {pages} \nobreakspace }
            \tabularnewline
          }
      }
      { \AcroRerun }  
    \acroheading
    \acropreamble
    \par \noindent
    \begin {xltabular} {\linewidth} {>{\bfseries}lX}
      \AcronymTable
    \end {xltabular}
  }

\hook_gput_code:nnn {package/tabularray/after} {acro}
  {
    \NewTblrTheme {acro} { \DefTblrTemplate {foot} {default} {} }
    \NewTblrEnviron {actblr}
    \SetTblrOuter [actblr] {
      long ,
      expand = \AcronymTable ,
      theme = acro ,
      entry = none ,
      label = none
    }
    \SetTblrInner [actblr] { rowsep = 0pt }
  }

\NewAcroTemplate [list] {tabularray}
  {
    \AcroNeedPackage {tabularray}
    \acronymsmapF
      {
        \AcroAddRow
          {
            \acrowrite {short}
            \acroifT {alt} {/} \acrowrite {alt}
            &
            \acrowrite {list}
            \acroifanyT {foreign,extra} {~(}
            \acrowrite {foreign}
            \acroifallT {foreign,extra} {,~}
            \acrowrite {extra}
            \acroifanyT {foreign,extra} {)}
            \acropagefill
            \acropages
              { \acrotranslate {page} \nobreakspace }
              { \acrotranslate {pages} \nobreakspace }
            \strut \\
          }
      }
      { \AcroRerun }
    \acroheading
    \acropreamble
    \par \noindent
    \begin {actblr} { colspec = {lX[l]}, column{1} = { font = \bfseries } }
      \AcronymTable
    \end {actblr}
  }

\let\l@acro\l@figure
  
\NewAcroTemplate [list] {lof}
  {
    \acroheading
    \acropreamble
    \acronopagerange
    \acroneedpages
    \acronymsmapF
      {
        \contentsline {acro}
          {
            \numberline
              { \acrowrite {short} \acroifT {alt} {/} \acrowrite {alt} }
              {
                \acrowrite {list}
                \acroifanyT {foreign,extra} {~(}
                \acrowrite {foreign}
                \acroifallT {foreign,extra} {,~}
                \acrowrite {extra}
                \acroifanyT {foreign,extra} {)}
              }
          }
          { \acropages {} {} }
          {}
      }
      { \AcroRerun }
  }

\NewAcroTemplate [list] {toc}
  {
    \acroheading
    \acropreamble
    \acronopagerange
    \acroneedpages
    \acronymsmapF
      {
        \contentsline { \acroifchapterTF {chapter} {section} }
          { \acrowrite {short} \acroifT {alt} {/} \acrowrite {alt} }
          {}{}
        \contentsline { \acroifchapterF {sub} section }
          {
            \acrowrite {list}
            \acroifanyT {foreign,extra} {~(}
            \acrowrite {foreign}
            \acroifallT {foreign,extra} {,~}
            \acrowrite {extra}
            \acroifanyT {foreign,extra} {)}
          }
          { \acropages {} {} }
          {}
      }
      { \AcroRerun }
  }

% --------------------------------------------------------------------------
% translations:
% list name
\DeclareAcroTranslation {list-name}
  {
    Fallback   = Acronyms ,
    English    = Acronyms ,
    French     = Acronymes ,
    German     = Abk\"urzungen ,
    Italian    = Acronimi ,
    Portuguese = Acr\'onimos ,
    Spanish    = Siglas ,
    Catalan    = Sigles
  }

% page name
\DeclareAcroTranslation {page}
  {
    Fallback   = p\abbrdot ,
    English    = p\abbrdot ,
    French     = p\abbrdot ,
    German     = S\abbrdot ,
    Italian    = p\abbrdot ,
    Portuguese = p\abbrdot ,
    Spanish    = p\'ag\abbrdot ,
    Catalan    = p\`ag\abbrdot
  }

% pages name
\DeclareAcroTranslation {pages}
  {
    Fallback   = pp\abbrdot ,
    English    = pp\abbrdot ,
    French     = p\abbrdot ,
    German     = S\abbrdot ,
    Italian    = pp\abbrdot ,
    Portuguese = pp\abbrdot ,
    Spanish    = p\'ags\abbrdot ,
    Catalan    = p\`ag\abbrdot
  }

% following page
\DeclareAcroTranslation {sequens}
  {
    Fallback   = f\abbrdot ,
    English    = f\abbrdot ,
    French     = sq\abbrdot ,
    German     = f\abbrdot ,
    Italian    = s\abbrdot ,
    Portuguese = s\abbrdot ,
    Spanish    = s\abbrdot ,
    Catalan    = seq\abbrdot
  }

% following pages
\DeclareAcroTranslation {sequentes}
  {
    Fallback   = ff\abbrdot ,
    English    = ff\abbrdot ,
    French     = sqq\abbrdot ,
    German     = ff\abbrdot ,
    Italian    = ss\abbrdot ,
    Portuguese = ss\abbrdot ,
    Spanish    = ss\abbrdot ,
    Catalan    = et seq\abbrdot
  }

% also
\DeclareAcroTranslation {also}
  {
    Fallback   = also ,
    English    = also ,
    French     = aussi ,
    German     = auch ,
    Italian    = anche ,
    Portuguese = tamb\'{e}m ,
    Spanish    = tambien ,
    Catalan    = tamb\'{e}
  }

% or
\DeclareAcroTranslation {or}
  {
    Fallback   = or ,
    English    = or ,
    French     = ou ,
    German     = oder ,
    Italian    = o ,
    Portuguese = ou ,
    Spanish    = o ,
    Catalan    = o
  }

% and
\DeclareAcroTranslation {and}
  {
    Fallback   = and ,
    English    = and ,
    French     = et ,
    German     = und ,
    Italian    = e ,
    Portuguese = e ,
    Spanish    = y ,
    Catalan    = i
  }

% --------------------------------------------------------------------------  
\AcroModuleEnd
